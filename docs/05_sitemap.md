# 05. サイトマップ（画面構成・遷移）

## MCP × Google Maps AIナビ PoC

---

## 1. 画面一覧

本PoCはSPA（Single Page Application）構成で、実質的に1画面で完結する。

| # | 画面名 | パス | 説明 |
|---|---|---|---|
| S-01 | ナビメイン画面 | `/` | 地図表示・入力・結果表示の全機能を統合した唯一の画面 |

---

## 2. 画面レイアウト

### 2.1 ナビメイン画面（S-01）

```
┌────────────────────────────────────────────────────────────┐
│  [ヘッダー]  AIナビ PoC — MCP × Google Maps                │
├──────────────────────────────────┬─────────────────────────┤
│                                  │                         │
│                                  │  [入力パネル]           │
│                                  │  ┌───────────────────┐ │
│                                  │  │ 📍 出発地          │ │
│         [地図エリア]              │  │ [東京駅         ]  │ │
│         Leaflet + OSM            │  │                    │ │
│                                  │  │ 📍 目的地          │ │
│         - ルート描画              │  │ [横浜駅         ]  │ │
│         - 出発地/目的地マーカー   │  │                    │ │
│         - ズーム/パン             │  │ 💬 ナビ条件        │ │
│                                  │  │ [渋滞を避けて    ] │ │
│                                  │  │                    │ │
│                                  │  │ [🔍 ルート検索]    │ │
│                                  │  └───────────────────┘ │
│                                  │                         │
│                                  │  [結果パネル]           │
│                                  │  ┌───────────────────┐ │
│                                  │  │ 距離: 32.4 km      │ │
│                                  │  │ 時間: 45分         │ │
│                                  │  │ 経由: 首都高速     │ │
│                                  │  └───────────────────┘ │
│                                  │                         │
│                                  │  [AI判断ログ]           │
│                                  │  ┌───────────────────┐ │
│                                  │  │ 🤖 route_search   │ │
│                                  │  │ を実行...          │ │
│                                  │  │ → 渋滞回避のため   │ │
│                                  │  │   departure_time   │ │
│                                  │  │   =now を指定      │ │
│                                  │  └───────────────────┘ │
├──────────────────────────────────┴─────────────────────────┤
│  [フッター]  Powered by Claude + MCP                       │
└────────────────────────────────────────────────────────────┘
```

### 2.2 レスポンシブ方針

PoCのため、デスクトップ（1280px以上）を主対象とする。モバイル対応は非スコープだが、最低限崩れない程度にする。

| 画面幅 | レイアウト |
|---|---|
| 1280px以上 | 左: 地図（70%） / 右: パネル（30%） |
| 768px〜1279px | 上: 地図（60%） / 下: パネル（40%） |
| 768px未満 | 縦スタック（地図→パネル） |

---

## 3. コンポーネント構成

### 3.1 コンポーネントツリー

```
App
├── Header
├── MainLayout
│   ├── MapView
│   │   ├── LeafletMap        （地図本体）
│   │   ├── RouteLayer        （ルートpolyline描画）
│   │   └── MarkerLayer       （出発地/目的地マーカー）
│   └── SidePanel
│       ├── InputForm
│       │   ├── LocationInput  （出発地入力）
│       │   ├── LocationInput  （目的地入力）
│       │   ├── MessageInput   （自然文条件入力）
│       │   └── SearchButton   （検索実行ボタン）
│       ├── ResultPanel
│       │   ├── RouteInfo      （距離・時間・経由情報）
│       │   └── StepList       （ターンバイターン案内）
│       └── ReasoningLog
│           ├── ToolCallEntry  （各ツール呼び出し詳細）
│           └── AiMessage      （Claudeの判断説明）
└── Footer
```

### 3.2 各コンポーネント責務

| コンポーネント | 責務 | state保持 |
|---|---|---|
| App | 全体状態管理、APIコール | ✅ ルート情報、会話履歴、ローディング状態 |
| Header | アプリ名表示 | なし |
| MapView | Leaflet地図の初期化・表示 | ✅ 地図インスタンス参照 |
| RouteLayer | polyline座標を受け取り地図上に線を描画 | なし（propsのみ） |
| MarkerLayer | 出発地/目的地の座標にマーカーを配置 | なし（propsのみ） |
| InputForm | 入力値の管理、フォーム送信 | ✅ 入力値 |
| LocationInput | 地名テキスト入力 | ✅ 入力値 |
| MessageInput | 自然文条件入力 | ✅ 入力値 |
| ResultPanel | ルート結果の表示 | なし（propsのみ） |
| ReasoningLog | AI判断過程の表示 | なし（propsのみ） |

---

## 4. 状態管理

### 4.1 アプリケーション状態

PoCのためRedux等は使わず、App コンポーネントの `useState` + propsドリルダウンで管理する。

```typescript
interface AppState {
  // 入力
  origin: string;
  destination: string;
  message: string;

  // API通信
  isLoading: boolean;
  error: string | null;

  // 結果
  route: RouteData | null;
  reasoning: ReasoningData | null;

  // 会話
  conversationHistory: Message[];
}
```

### 4.2 状態遷移

```
[初期状態]
  │  ユーザーがフォーム入力
  ▼
[入力完了] → 検索ボタン押下
  │  POST /api/navigate
  ▼
[ローディング中]
  │  ├── 成功 → [結果表示]（地図にルート描画 + 結果パネル表示）
  │  └── 失敗 → [エラー表示]
  ▼
[結果表示]
  │  ユーザーが条件変更して再検索
  ▼
[ローディング中] → ...繰り返し
```

---

## 5. 画面遷移

本PoCはSPAで画面遷移は存在しない。全ての操作はナビメイン画面内で完結する。

```
/ (ナビメイン画面)
└── 状態変化のみ（ページ遷移なし）
    ├── 初期表示 → 入力待ち
    ├── 検索中 → ローディング表示
    ├── 結果表示 → ルート描画
    └── エラー → エラーメッセージ
```

React Routerは不使用（不要なため）。

---

## 6. UI/UXの要点

### 6.1 ナビ風UIのポイント

- 地図が画面の主役（面積の70%）
- 入力パネルは地図の右サイドに固定（カーナビの操作パネルを模倣）
- 暗めの配色（ダークモード寄り）で車載ナビの雰囲気を演出
- ルートはcyan系の目立つ色で描画

### 6.2 AI判断の可視化

- 検索中: 「🤖 Claudeが考えています...」→「route_searchを実行中...」のようにステップ表示
- 結果後: どのツールを、どのパラメータで、なぜ使ったかを折りたたみ表示

### 6.3 カラースキーム（案）

| 要素 | 色 |
|---|---|
| 背景 | #1a1a2e（ダークネイビー） |
| パネル背景 | #16213e |
| テキスト | #e0e0e0 |
| ルート線 | #00d4ff（シアン） |
| マーカー（出発） | #4ade80（グリーン） |
| マーカー（目的地） | #f87171（レッド） |
| ボタン | #3b82f6（ブルー） |
| AI判断ログ | #8b5cf6（パープル） |
